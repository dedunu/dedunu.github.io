---
layout: post
title: 'MySQL/MariaDB: Using expressions and conditions in Update'
date: '2019-08-06T02:41:00.000+03:00'
author: Dedunu Dhananjaya
tags:
- mysql
- mariadb
modified_time: '2019-08-06T02:46:21.665+03:00'
thumbnail: https://1.bp.blogspot.com/-9KTej5M8oEw/XUi6iMW6kyI/AAAAAAAAGVU/hKAcrjonH28_rx4E_pOH2GuSRiylYNEZQCLcBGAs/s72-c/Screenshot%2B2019-08-06%2Bat%2B2.01.47%2BAM.png
blogger_id: tag:blogger.com,1999:blog-8327060682734922468.post-4858726959275154381
permalink: www.dedunu.info/2019/08/mysqlmariadb-using-expressions-and.html
---

I ran a few update queries against a MySQL database. Update command said it updated some records. But data didn't seem to be as we expect. Let's say the table looked like below.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-9KTej5M8oEw/XUi6iMW6kyI/AAAAAAAAGVU/hKAcrjonH28_rx4E_pOH2GuSRiylYNEZQCLcBGAs/s1600/Screenshot%2B2019-08-06%2Bat%2B2.01.47%2BAM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="340" data-original-width="710" height="305" src="https://1.bp.blogspot.com/-9KTej5M8oEw/XUi6iMW6kyI/AAAAAAAAGVU/hKAcrjonH28_rx4E_pOH2GuSRiylYNEZQCLcBGAs/s640/Screenshot%2B2019-08-06%2Bat%2B2.01.47%2BAM.png" width="640" /></a></div><br />I ran a query which is similar to below.<br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">UPDATE update_test SET age = 30 AND name = 'John' WHERE id = 1;</span><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-rg4VUo3_WLc/XUi63TcaR6I/AAAAAAAAGVc/I8adjYhRRzYS0e6_s7xEqyopXnFvewZ8gCLcBGAs/s1600/Screenshot%2B2019-08-06%2Bat%2B2.01.37%2BAM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="520" data-original-width="1216" height="272" src="https://1.bp.blogspot.com/-rg4VUo3_WLc/XUi63TcaR6I/AAAAAAAAGVc/I8adjYhRRzYS0e6_s7xEqyopXnFvewZ8gCLcBGAs/s640/Screenshot%2B2019-08-06%2Bat%2B2.01.37%2BAM.png" width="640" /></a></div><br />MySQL prompt says that it managed to update one row. But if you look at the data after the update query, it will be clear that <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">age</span> is not <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">30</span> or neither the <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">name</span> is '<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">John</span>'. This is because the query is interpreted as an expression.<br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">UPDATE update_test SET age = (30 AND name = 'John') WHERE id = 1;</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">Let's look at another query.</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"><br /></span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">UPDATE update_test SET age = 30 AND name = 'Larry' WHERE id = 3;</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"><br /></span><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-Ufk9EdO3CPo/XUi7xwQbqXI/AAAAAAAAGVk/V1a5_c-zoEEB_hdOjmO_wJ9RF8RQBA7-gCLcBGAs/s1600/Screenshot%2B2019-08-06%2Bat%2B2.01.29%2BAM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="564" data-original-width="1256" height="284" src="https://1.bp.blogspot.com/-Ufk9EdO3CPo/XUi7xwQbqXI/AAAAAAAAGVk/V1a5_c-zoEEB_hdOjmO_wJ9RF8RQBA7-gCLcBGAs/s640/Screenshot%2B2019-08-06%2Bat%2B2.01.29%2BAM.png" width="640" /></a></div><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"><br /></span><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">The output says it didn't update any records because age is already 0 and our update query is actually trying to set it as 0. Replacing </span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">AND</span><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"> with "</span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">,</span><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">" will set both fields.</span><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">&nbsp;</span><br /><br class="Apple-interchange-newline" /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">UPDATE update_test SET age = 30, name = 'Larry' WHERE id = 3;</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"><br /></span><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">With this expression evaluation, we can write advance update queries. For example, I am going to update student data. My update query should update the </span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">highest_mark</span><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"> field from the highest value of </span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">eng_marks</span><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"> or </span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">sci_marks</span><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"> field. Both </span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">eng_marks</span><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"> and </span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">sci_marks</span><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"> should be higher than 50 too. The query looks like below.</span><br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">UPDATE students SET highest_mark = IF(eng_marks &gt; sci_marks, eng_marks, sci_marks) WHERE eng_marks &gt; 50 AND sci_marks &gt; 50;</span><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"><br /></span><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-IqRvVNQMyiE/XUi9BJKimOI/AAAAAAAAGVs/AG8-JN0sG7YYndSecbXPj0IZmqzamYnDgCLcBGAs/s1600/Screenshot%2B2019-08-06%2Bat%2B2.22.03%2BAM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="1124" data-original-width="1440" height="499" src="https://1.bp.blogspot.com/-IqRvVNQMyiE/XUi9BJKimOI/AAAAAAAAGVs/AG8-JN0sG7YYndSecbXPj0IZmqzamYnDgCLcBGAs/s640/Screenshot%2B2019-08-06%2Bat%2B2.22.03%2BAM.png" width="640" /></a></div><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"><br /></span><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">Thanks a lot, Ross for helping to figure this out!</span>