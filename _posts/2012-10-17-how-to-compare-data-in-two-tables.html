---
layout: post
title: How to compare data in two tables?
date: '2012-10-17T12:20:00.000+03:00'
author: Dedunu Dhananjaya
tags:
- SQL
- Comparing tables
- Table
- Identical Tables
- T-SQL
- TSQL
- Table Compare
- SQL Server
modified_time: '2019-07-09T17:29:58.615+03:00'
blogger_id: tag:blogger.com,1999:blog-8327060682734922468.post-3235377766579681522
blogger_orig_url: https://www.dedunu.info/2012/10/how-to-compare-data-in-two-tables.html
---

<div dir="ltr" style="text-align: left;" trbidi="on">At the beginning of this week, I got a task from <a href="http://www.sqlservertorque.com/" target="_blank">Susantha</a> to modify a stored procedure. After the modification, I had to test to compare the result sets before modification and after modification. That procedure only returns a data table. So I had so many test data on another table. Then I wrote a script to go through the script one by one. Actually, I wanted to check whether those results are identical. I mean not the table structure. I wanted to perform a data comparison.<br /><pre class="code"><span style="color: blue;">DECLARE </span><span style="color: teal;">@COUNTN </span><span style="color: blue;">INT</span><span style="color: grey;">;</span><span style="color: blue;">DECLARE </span><span style="color: teal;">@COUNTO </span><span style="color: blue;">INT</span><span style="color: grey;">;</span><span style="color: blue;">DECLARE </span><span style="color: teal;">@COUNTU </span><span style="color: blue;">INT</span><span style="color: grey;">;<br /></span><span style="color: blue;">CREATE TABLE </span><span style="color: teal;">#TEMPN<br />    </span><span style="color: grey;">(<br />        </span><span style="color: green;">--Columns Here<br />    </span><span style="color: grey;">)<br /></span><span style="color: blue;">CREATE TABLE </span><span style="color: teal;">#TEMPO<br />    </span><span style="color: grey;">(<br />        </span><span style="color: green;">--Columns Here<br />    </span><span style="color: grey;">)<br /></span><span style="color: blue;">CREATE TABLE </span><span style="color: teal;">#TEMPU<br />    </span><span style="color: grey;">(<br />        </span><span style="color: green;">--Columns Here<br />    </span><span style="color: grey;">)<br /></span><span style="color: blue;">INSERT INTO </span><span style="color: teal;">#TEMPN <br />    </span><span style="color: green;">--Select From new table         <br /></span><span style="color: blue;">INSERT INTO </span><span style="color: teal;">#TEMPO<br />    </span><span style="color: green;">--Select From old table     <br /></span><span style="color: blue;">SELECT  </span><span style="color: teal;">@COUNTU </span><span style="color: grey;">= </span><span style="color: magenta;">COUNT</span><span style="color: grey;">(</span>1<span style="color: grey;">)</span><span style="color: blue;">FROM    </span><span style="color: teal;">#TEMPU</span><span style="color: blue;">SELECT  </span><span style="color: teal;">@COUNTN </span><span style="color: grey;">= </span><span style="color: magenta;">COUNT</span><span style="color: grey;">(</span>1<span style="color: grey;">)</span><span style="color: blue;">FROM    </span><span style="color: teal;">#TEMPN</span><span style="color: blue;">SELECT  </span><span style="color: teal;">@COUNTO </span><span style="color: grey;">= </span><span style="color: magenta;">COUNT</span><span style="color: grey;">(</span>1<span style="color: grey;">)</span><span style="color: blue;">FROM    </span><span style="color: teal;">#TEMPO<br /></span><span style="color: blue;">IF </span><span style="color: teal;">@COUNTN </span><span style="color: grey;">&lt;&gt; </span><span style="color: teal;">@COUNTO <br />    </span><span style="color: blue;">BEGIN<br />        SELECT  </span><span style="color: grey;">*<br />        </span><span style="color: blue;">FROM    </span><span style="color: teal;">#TEMPN<br />        </span><span style="color: blue;">SELECT  </span><span style="color: grey;">*<br />        </span><span style="color: blue;">FROM    </span><span style="color: teal;">#TEMPO<br />        </span><span style="color: blue;">PRINT </span><span style="color: red;">'ERROR' <br />    </span><span style="color: blue;">END<br /><br />IF </span><span style="color: teal;">@COUNTN </span><span style="color: grey;">&lt;&gt; </span><span style="color: teal;">@COUNTU <br />    </span><span style="color: blue;">BEGIN<br />        SELECT  </span><span style="color: grey;">*<br />        </span><span style="color: blue;">FROM    </span><span style="color: teal;">#TEMPN<br />        </span><span style="color: blue;">SELECT  </span><span style="color: grey;">*<br />        </span><span style="color: blue;">FROM    </span><span style="color: teal;">#TEMPO<br />        </span><span style="color: blue;">PRINT </span><span style="color: red;">'ERROR' <br />    </span><span style="color: blue;">END<br /><br />IF </span><span style="color: teal;">@COUNTU </span><span style="color: grey;">&lt;&gt; </span><span style="color: teal;">@COUNTO <br />    </span><span style="color: blue;">BEGIN<br />        SELECT  </span><span style="color: grey;">*<br />        </span><span style="color: blue;">FROM    </span><span style="color: teal;">#TEMPN<br />        </span><span style="color: blue;">SELECT  </span><span style="color: grey;">*<br />        </span><span style="color: blue;">FROM    </span><span style="color: teal;">#TEMPO<br />        </span><span style="color: blue;">PRINT </span><span style="color: red;">'ERROR' <br />    </span><span style="color: blue;">END<br /><br />DROP TABLE </span><span style="color: teal;">#TEMPN</span><span style="color: blue;">DROP TABLE </span><span style="color: teal;">#TEMPO</span><span style="color: blue;">DROP TABLE </span><span style="color: teal;">#TEMPU    </span></pre><br /><br />This will check whether your data in two tables are identical or not. if there’s any mismatch it will print an error and show both result sets. And there’s another issue on this script if one table returns NULL and the other table returns empty table it will take it as matched. Then I corrected it again.<br /><pre class="code"><span style="color: blue;">DECLARE </span><span style="color: teal;">@COUNTN </span><span style="color: blue;">INT</span><span style="color: grey;">;</span><span style="color: blue;">DECLARE </span><span style="color: teal;">@COUNTO </span><span style="color: blue;">INT</span><span style="color: grey;">;</span><span style="color: blue;">DECLARE </span><span style="color: teal;">@COUNTU </span><span style="color: blue;">INT</span><span style="color: grey;">;<br /></span><span style="color: blue;">CREATE TABLE </span><span style="color: teal;">#TEMPN<br />    </span><span style="color: grey;">(<br />        </span><span style="color: green;">--Columns Here<br />    </span><span style="color: grey;">)<br /></span><span style="color: blue;">CREATE TABLE </span><span style="color: teal;">#TEMPO<br />    </span><span style="color: grey;">(<br />        </span><span style="color: green;">--Columns Here<br />    </span><span style="color: grey;">)<br /></span><span style="color: blue;">CREATE TABLE </span><span style="color: teal;">#TEMPU<br />    </span><span style="color: grey;">(<br />        </span><span style="color: green;">--Columns Here<br />    </span><span style="color: grey;">)<br /></span><span style="color: blue;">INSERT INTO </span><span style="color: teal;">#TEMPN <br />    </span><span style="color: green;">--Select From new table         <br /></span><span style="color: blue;">INSERT INTO </span><span style="color: teal;">#TEMPO<br />    </span><span style="color: green;">--Select From old table     <br /></span><span style="color: blue;">SELECT  </span><span style="color: teal;">@COUNTU </span><span style="color: grey;">= </span><span style="color: magenta;">COUNT</span><span style="color: grey;">(</span>1<span style="color: grey;">)</span><span style="color: blue;">FROM    </span><span style="color: teal;">#TEMPU</span><span style="color: blue;">SELECT  </span><span style="color: teal;">@COUNTN </span><span style="color: grey;">= </span><span style="color: magenta;">COUNT</span><span style="color: grey;">(</span>1<span style="color: grey;">)</span><span style="color: blue;">FROM    </span><span style="color: teal;">#TEMPN</span><span style="color: blue;">SELECT  </span><span style="color: teal;">@COUNTO </span><span style="color: grey;">= </span><span style="color: magenta;">COUNT</span><span style="color: grey;">(</span>1<span style="color: grey;">)</span><span style="color: blue;">FROM    </span><span style="color: teal;">#TEMPO<br /></span><span style="color: blue;">IF </span><span style="color: teal;">@COUNTN </span><span style="color: grey;">&lt;&gt; </span><span style="color: teal;">@COUNTO <br />    </span><span style="color: blue;">BEGIN<br />        SELECT  </span><span style="color: grey;">*<br />        </span><span style="color: blue;">FROM    </span><span style="color: teal;">#TEMPN<br />        </span><span style="color: blue;">SELECT  </span><span style="color: grey;">*<br />        </span><span style="color: blue;">FROM    </span><span style="color: teal;">#TEMPO<br />        </span><span style="color: blue;">PRINT </span><span style="color: red;">'ERROR' <br />    </span><span style="color: blue;">END<br /><br />IF </span><span style="color: teal;">@COUNTN </span><span style="color: grey;">&lt;&gt; </span><span style="color: teal;">@COUNTU <br />    </span><span style="color: blue;">BEGIN<br />        SELECT  </span><span style="color: grey;">*<br />        </span><span style="color: blue;">FROM    </span><span style="color: teal;">#TEMPN<br />        </span><span style="color: blue;">SELECT  </span><span style="color: grey;">*<br />        </span><span style="color: blue;">FROM    </span><span style="color: teal;">#TEMPO<br />        </span><span style="color: blue;">PRINT </span><span style="color: red;">'ERROR' <br />    </span><span style="color: blue;">END<br /><br />IF </span><span style="color: teal;">@COUNTU </span><span style="color: grey;">&lt;&gt; </span><span style="color: teal;">@COUNTO <br />    </span><span style="color: blue;">BEGIN<br />        SELECT  </span><span style="color: grey;">*<br />        </span><span style="color: blue;">FROM    </span><span style="color: teal;">#TEMPN<br />        </span><span style="color: blue;">SELECT  </span><span style="color: grey;">*<br />        </span><span style="color: blue;">FROM    </span><span style="color: teal;">#TEMPO<br />        </span><span style="color: blue;">PRINT </span><span style="color: red;">'ERROR' <br />    </span><span style="color: blue;">END<br /></span><span style="color: blue;"><pre class="code"><span style="color: green;">--New Code Block here</span><br /><br /><span style="color: green;"></span><span style="color: blue;">IF </span><span style="color: grey;">EXISTS(</span><span style="color: teal;">#TEMPO</span><span style="color: grey;">)<br />    </span><span style="color: blue;">BEGIN<br />        IF </span><span style="color: grey;">NOT EXISTS(</span><span style="color: teal;">#TEMPN</span><span style="color: grey;">)<br />        </span><span style="color: blue;">BEGIN<br />            SELECT </span><span style="color: grey;">* <br />            </span><span style="color: blue;">FROM </span><span style="color: teal;">#TEMPN<br />            </span><span style="color: blue;">SELECT </span><span style="color: grey;">* <br />            </span><span style="color: blue;">FROM </span><span style="color: teal;">#TEMPO<br />            </span><span style="color: blue;">PRINT </span><span style="color: red;">'ERROR'<br />        </span><span style="color: blue;">END<br />    END <br /><br /><br />IF </span><span style="color: grey;">EXISTS(</span><span style="color: teal;">#TEMPN</span><span style="color: grey;">)<br />    </span><span style="color: blue;">BEGIN<br />        IF </span><span style="color: grey;">NOT EXISTS(</span><span style="color: teal;">#TEMPO</span><span style="color: grey;">)<br />        </span><span style="color: blue;">BEGIN<br />            SELECT </span><span style="color: grey;">* <br />            </span><span style="color: blue;">FROM </span><span style="color: teal;">#TEMPN<br />            </span><span style="color: blue;">SELECT </span><span style="color: grey;">* <br />            </span><span style="color: blue;">FROM </span><span style="color: teal;">#TEMPO<br />            </span><span style="color: blue;">PRINT </span><span style="color: red;">'ERROR'<br />        </span><span style="color: blue;">END<br />    END </span></pre>DROP TABLE </span><span style="color: teal;">#TEMPN</span><span style="color: blue;">DROP TABLE </span><span style="color: teal;">#TEMPO</span><span style="color: blue;">DROP TABLE </span><span style="color: teal;">#TEMPU    </span></pre></div>