---
layout: post
title: SQL Server is not releasing memory?
date: '2012-10-12T11:59:00.000+03:00'
author: Dedunu Dhananjaya
tags:
- Memory
- Architecture
- SQL Server
modified_time: '2019-07-09T17:28:45.848+03:00'
blogger_id: tag:blogger.com,1999:blog-8327060682734922468.post-3331266316099854371
blogger_orig_url: https://www.dedunu.info/2012/10/sql-server-is-not-releasing-memory.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><div align="justify">I got a few questions to answer quickly in last week just like a test. Then I suddenly answered then after that I tried to find correct answers to them. I found answers for most of them. And one of them was there as it was. </div><blockquote>A Windows server has 32 GB of memory and dedicated for SQL Server database. Every time you start the server the memory utilization of SQL Server gradually increases, until it takes almost all the memory and remains there for days even when there is no database activity. What will you do ? </blockquote><div align="justify">Actually, I answered </div><blockquote>We can set maximum memory limit. Some how gradually SQL Server uses available memory.</blockquote><div align="justify">I knew that SQL Server uses and usually doesn’t release memory, although it doesn't need to use it. But I didn’t know why is that. Then I got to know that Not releasing memory is a feature of SQL Server. On servers, we don’t run our day to day applications and most of the times we have allocated separate box for SQL Server. Then nobody will use that memory. If nobody uses that why should we release and allocate again and again? When we are discussing this problem our production server had reached its maximum memory too.&nbsp;And this is not our production servers.</div><a href="http://dedunumax.files.wordpress.com/2012/10/sql-server-memory-leak.jpg"><img alt="sql server memory leak" border="0" src="https://dedunumax.files.wordpress.com/2012/10/sql-server-memory-leak_thumb.jpg" height="579" style="background-image: none; border-bottom: 0; border-left: 0; border-right: 0; border-top: 0; display: inline; padding-left: 0; padding-right: 0; padding-top: 0;" title="sql server memory leak" width="921"></a><br /> <div align="justify"><a href="http://preethiviraj.blogspot.com/" target="_blank">Preethi</a> told that this happens often. People who don’t know about SQL Server behaviour when saw “task manager” like above they are suggesting to double the memory of the server. Then until it takes a few days they are happy. Again they are having the same issue.&nbsp;Actually, it’s not a problem with SQL Server. </div><div align="justify">If you really want to release that memory you can easily restart SQL Server. Then it begins everything from the beginning. Otherwise, you can execute those commands. </div><ul><li><a href="http://msdn.microsoft.com/en-us/library/ms174283.aspx" target="_blank">DBCC FREEPROCCACHE</a></li><li><a href="http://msdn.microsoft.com/en-us/library/ms178529.aspx" target="_blank">DBCC FREESYSTEMCACHE</a></li><li><a href="http://msdn.microsoft.com/en-us/library/ms187781.aspx" target="_blank">DBCC FREESESSIONCACHE</a></li></ul><div align="justify">But even in the TechNet, they haven’t mentioned that it is recommended running those commands against production servers. Somehow as I think theirs no need to flush memory manually. Because if you are using SQL Server on your laptop, every time that you restart your laptop it will flush again and again. In production servers, we don’t need to flush it manually. Let SQL Server use that memory as it wants. </div><div align="justify">If you are using one box to install SQL Server and Application both you can set maximum memory limit to SQL Server. Then it will not exceed that limit. But I found this thread from <a href="http://www.sqlservercentral.com/" target="_blank">SQLServerCentral</a>. </div><div align="justify"><a href="http://www.sqlservercentral.com/Forums/Topic982342-1550-1.aspx">http://www.sqlservercentral.com/Forums/Topic982342-1550-1.aspx</a></div><div align="justify">In that thread he is saying that SQL Server exceeds that maximum memory limit. But technically it should not happen. And I haven’t tested it also. But there may be a reason for that too. If you are setting maximum memory limit you should restart SQL Server. If you don’t restart it, it uses previous memory limit. Somehow below link says another thing. I have to learn about it further. <img alt="Smile" class="wlEmoticon wlEmoticon-smile" src="https://dedunumax.files.wordpress.com/2012/10/wlemoticon-smile.png" style="border-style: none;"></div><blockquote>Yup. Perfectly normal.<br />Max server memory is the max size of the buffer pool, the memory area that contains the data cache, plan cache and a whole bunch of other caches. SQL also uses memory outside the buffer pool for things like backup buffers, thread stack, linked server drivers, CLR and a few other things. This is outside of the buffer pool, so it's not part of 'max server memory'<br />On 32-bit SQL, that's referred to as MemToLeave (memory to leave unallocated when assigning the buffer pool). On 64 bit that term has no meaning.<br /><a href="http://www.sqlservercentral.com/Forums/Topic1197388-1550-1.aspx">http://www.sqlservercentral.com/Forums/Topic1197388-1550-1.aspx</a></blockquote>Picture: <a href="http://piglings.blogspot.com/2009/10/sql-server-2008-memory-leak.html">http://piglings.blogspot.com/2009/10/sql-server-2008-memory-leak.html</a><br /><br /></div>